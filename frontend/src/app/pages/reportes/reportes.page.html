<ion-content [fullscreen]="true">
  <app-wrapper></app-wrapper>
  <ion-card
    ><ion-card-header>
      <ion-card-title>Cinta de Opciones</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="auto">
            <ion-button color="warning" (click)="clearFilters()">
              <ion-icon name="close-outline" slot="start"></ion-icon>
              Limpiar Filtros
            </ion-button>
          </ion-col>

          <ion-col size="auto">
            <ion-button
              color="danger"
              (click)="printSection()"
              [disabled]="!reporteSeleccionado">
              <ion-icon name="print-outline" slot="start"></ion-icon>
              Imprimir
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
  <ion-grid>
    <ion-row>
      <ion-col size-xs="12" size-md="6" size-lg="4">
        <ion-card>
          <ion-card-header>
            @if(currentUser.rolid!==3){
            <ion-card-title>Panel Administrativo</ion-card-title>
            }@else {
            <ion-card-title>Panel Asesor</ion-card-title>
            }
          </ion-card-header>
          <ion-card-content class="p-4">
            <!-- <ion-grid>
              <ion-row>
                @if(currentUser.rolid!==3){
                <ion-col size="auto">
                  <ion-item>
                    <ion-toggle
                      [(ngModel)]="isFilterAsesor"
                      [disabled]="!enableFilterAsesor"
                      (ionChange)="filterAsesor($event)"
                      >Filtrar por Asesor</ion-toggle
                    >
                  </ion-item>
                </ion-col>
                }
                <ion-col size="auto">
                  <ion-item>
                    <ion-toggle
                      [(ngModel)]="isFilterCliente"
                      [disabled]="!enableFilterCliente"
                      (ionChange)="filterCliente($event)"
                      >Filtrar por Cliente</ion-toggle
                    >
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-grid> -->
            @if(currentUser.rolid!==3){
            <ion-item lines="none" class="ion-margin-top">
              <ion-label>
                <h2 class="ion-text-wrap">Asesor Seleccionado</h2>
                <p *ngIf="selectedAsesor; else noAsesor">
                  {{ selectedAsesor.nombre }} {{ selectedAsesor.apellido }}
                </p>
                <ng-template #noAsesor>
                  <p>No se ha seleccionado un asesor</p>
                </ng-template>
              </ion-label>
              <ion-button
                slot="end"
                color="primary"
                (click)="showOpenModal(true, 'asesor')"
                shape="round"
                [disabled]="!enableFilterAsesor">
                <ion-icon name="search-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-item>
            }

            <ion-item lines="none" class="ion-margin-top">
              <ion-label>
                <h2 class="ion-text-wrap">Cliente Seleccionado</h2>
                <p *ngIf="selectedCliente; else noCliente">
                  {{ selectedCliente.nombres }} {{ selectedCliente.apellidos }}
                </p>
                <ng-template #noCliente>
                  <p>No se ha seleccionado un cliente</p>
                </ng-template>
              </ion-label>
              <ion-button
                slot="end"
                color="primary"
                (click)="showOpenModal(true, 'cliente')"
                shape="round"
                [disabled]="!enableFilterCliente">
                <ion-icon name="search-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <ion-card>
          <ion-card-header>
            <ion-card-title>Reportes</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item button (click)="seleccionarReporte('clientes-mora')">
                <ion-icon name="people-outline" slot="start"></ion-icon>
                <ion-label>Clientes en Mora</ion-label>
              </ion-item>
              <ion-item button (click)="seleccionarReporte('estado-cuenta')">
                <ion-icon name="document-text-outline" slot="start"></ion-icon>
                <ion-label>Estado de Cuenta</ion-label>
              </ion-item>
              <ion-item
                button
                (click)="seleccionarReporte('record-crediticio')">
                <ion-icon name="time-outline" slot="start"></ion-icon>
                <ion-label>Record Crediticio</ion-label>
              </ion-item>
              <ion-item button (click)="seleccionarReporte('cartera-asesor')">
                <ion-icon name="briefcase-outline" slot="start"></ion-icon>
                <ion-label>Cartera Asesor</ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size-xs="12" size-md="6" size-lg="8">
        <ion-card style="min-height: 100vh">
          <ion-card-header>
            <ion-card-title>Reporte Actual</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <br />
            <section id="report-print">
              @switch (reporteSeleccionado) { @case ('estado-cuenta') { @if
              (selectedCliente) {
              <app-report-estado-cuenta
                [company]="company"></app-report-estado-cuenta>
              } @else {
              <report-loader
                [loading]="loading"
                [textLoader]="'cliente'"></report-loader>
              } } @case ('clientes-mora') {
              <app-report-clients-mora
                [company]="company"
                [currentUser]="currentUser"></app-report-clients-mora>
              } @case ('record-crediticio') { @if (selectedCliente) {
              <app-report-record-crediticio
                [selectedCliente]="selectCliente"
                [company]="company"></app-report-record-crediticio>
              } @else {
              <report-loader
                [loading]="loading"
                [textLoader]="'cliente'"></report-loader>
              } } @case ('cartera-asesor') { @if (selectedAsesor ||
              currentUser.rolid === 3) {
              <app-report-cartera-asesores
                [idAsesor]="selectedAsesor?.id || 0"></app-report-cartera-asesores>
              } @else {
              <report-loader
                [loading]="loading"
                [textLoader]="'asesor'"></report-loader>
              } } @default {
              <report-loader [loading]="loading"></report-loader>
              } }
            </section>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <app-reusable-modal
    [(isOpen)]="isModalOpen"
    [content]="modalSelected"
    (saveData)="handleSave($event)">
  </app-reusable-modal>

  <ng-template #modalAsesorSelector let-close="close" let-save="save">
    <ion-header>
      <ion-toolbar>
        <ion-title>Seleccionar Asesor</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="close()">Cerrar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-searchbar
        (ionInput)="filterAsesores($event)"
        placeholder="Buscar asesor"></ion-searchbar>
      <ion-list>
        <ion-item
          class="user-select-none"
          *ngFor="let asesor of filteredAsesores"
          (click)="selectAsesor(asesor)">
          <ion-label>
            <h2>{{ asesor.nombre }} {{ asesor.apellido }}</h2>
            <p>{{ asesor.correo }}</p>
          </ion-label>
        </ion-item>
        <ion-item class="user-select-none" (click)="selectAsesor(null)">
          <ion-label>
            <h2>Sin Selección</h2>
            <p>N/D</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
  <ng-template #modalClienteSelector let-close="close" let-save="save">
    <ion-header>
      <ion-toolbar>
        <ion-title>Seleccionar Cliente</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="close()">Cerrar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-searchbar
        (ionInput)="filterClientes($event)"
        placeholder="Buscar cliente"></ion-searchbar>
      <ion-list>
        <ion-item
          class="user-select-none"
          *ngFor="let cliente of filteredClientes"
          (click)="selectCliente(cliente)">
          <ion-label>
            <h2>{{ cliente.nombres }} {{ cliente.apellidos }}</h2>
            <p>{{ cliente.email }}</p>
          </ion-label>
        </ion-item>
        <ion-item class="user-select-none" (click)="selectCliente(null)">
          <ion-label>
            <h2>Sin Selección</h2>
            <p>N/D</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-content>
